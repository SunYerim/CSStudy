## JWT (JSON Web Token)

JWT는 웹표준(REC 7519)으로서 두 개체에서 JSON 객체를 사용하여 가볍고 자기수용적인 방식으로 정보를 안전성 있게 전달해준다.

<br>

### 구성 요소

---

JWT는 .을 구분자로 3가지의 문자열로 구성되어 있다. <br>
`aaa.bbbbb.ccccc`의 구조로 앞부터 헤더(header), 내용(payload), 서명(signature)로 구성된다.

<br>

### 헤더

---

헤더는 typ와 alg 두 가지의 정보를 지니고 있다. <br>

- **typ** <br>
  토큰의 타입을 지정한다. JWT이기에 "JWT"라는 값이 들어간다.
- **alg** <br>
  <u>해싱 알고리즘</u>을 지정한다. 기본적으로 HMAC, SHA256, RSA가 사용되면 토큰을 검증 할 때 사용되는 signature 부분에서 사용된다. <br><br>
  ```
  {
      "typ" : "JWT",
      "alg" : "HS256"
  }
  ```

<br>

### 정보(payload)

---

Payload 부분에는 <u>토큰을 담을 정보</u>가 들어있다. 정보의 한 조각을 **클레임(claim)** 이라고 부르고, 이는 name/value의 한 쌍으로 이뤄져있다. 토큰에는 여러 개의 클레임들을 넣을 수 있지만 너무 많아질 경우 토큰의 길이가 길어질 수 있다.

<br>

💡 **_클레임의 종류_** <br>

1. **등록된 클레임** <br>
   등록된 클레임들은 서비스에서 필요한 정보들이 아닌, 토큰에 대한 정보들을 담기 위하여 이름이 이미 정해진 클레임들이다. 등록된 클레임의 사용은 모두 선택적이며, 이에 포함된 클레임 이름들은 다음과 같다. <br> - `iss` : 토큰 발급자 <br> - `sub` : 토큰 제목 <br> - `aud` : 토큰 대상자 <br> - `exp` : 토큰의 만료시간, 시간은 NumericDate 형식으로 되어 있어야 하며 언제나 현재 시간보다 이후로 설정되어 있어야 한다 <br> - `nbf` : Not before을 의미하며 토큰의 활성 날짜와 비슷한 개념이다 여기에도 NumericDate 형식으로 날짜를 지정하며 이 날짜가 지나기 전까지는 토큰이 처리되지 않는다. <br> - `iat` : 토큰이 발급된 시간, 이 값을 사용하여 토큰의 age가 얼마나 되었는지 판단할 수 있다. <br> - `jti` : JWT의 고유 식별자로서, 주로 중복적인 처리를 방지하기 위해 사용

<br><br>

2. **공개 클레임** <br>
   공개 클레임들은 충돌이 방지된 이름을 가지고 있어야 한다. 충돌을 방지하기 위해서는 클레임 이름을 URI 형식으로 짓는다. <br>

   ```
   {
     "https:// ~ " : true
   }
   ```

<br><br>

3. **비공개 클레임** <br>
   등록된 클레임도 아니고, 공개된 클레임들도 아니다. 양측간에 합의하에 사용되는 클레임 이름이다. 공개 클레임과는 달리 이름이 중복되어 충돌이 될 수 있으니 사용할 때 유의해야 한다

<br><br>

### 서명

---

서명은 헤더의 인코딩값과 정보의 인코딩값을 합친 후 주어진 비밀키로 해쉬를 하여 생성한다. 이렇게 만든 해쉬를 **base64** 형태로 나타내게 된다.

<br><br>

> 💡 **_refresh token_** <br>
> refresh token은 access token과 똑같은 JWT이다. access token의 유효기간이 만료되었을 때 refresh token이 새로 발급해주는 열쇠가 된다. <br><br>
> 사용자는 access token의 시간이 만료되면 refresh token을 이용하여 새롭게 발급받을 수 있다. <br><br>
> refresh token도 탈취될 가능성이 있기 때문에 적절한 유효 기간 설정이 필요하다.

<br><br>

### 면접 질문 예상

---

<details>
  <summary>JWT에 대해서 간단히 설명해주세요.</summary>
  <br>
  JWT란 토큰 인증 방식에서 쓰이는 것이라고 볼 수 있습니다. 다른 사용으론 데이터를 공유하는데도 사용할 수 있지만 일반적으로 토큰 인증 방식에서 사용됩니다. <br><br>
  JWT는 헤더, 페이로드, 시그니처로 구분되며 헤더는 토큰의 타입, 암호화 알고리즘이 담겨 있고, 페이로드는 토큰의 정보를, 시그니처는 토큰의 정보가 신뢰할 수 있는 것인지 판단할 수 있도록 합니다. <br><br>
  JWT는 그 자체로 정보를 가지고 있기 때문에 세션의 단점을 보완할 수 있습니다. <br><br>
</details>
<br>
<details>
  <summary>Session/Cookie 방식과 JWT 차이점은 무엇인가요?</summary>
  <br>
  가장 큰 차이점은 Session/Cookie는 Session 저장소에 유저의 정보를 넣는 반면 JWT는 토큰 안에 유저의 정보들을 넣는다는 점입니다. <br><br>
  클라이언트 입장에서는 HTTP 헤더에 세션 ID나 토큰을 실어서 보내준다는 점에서 동일하지만 서버측에서는 인증을 위해 암호화를 하냐 별도의 저장소를 이용하냐의 차이가 발생하게 됩니다. 
</details>

<br><br>

> 💡 **Bearer 타입 인증이란 Oauth2에서 지원하는 토큰 기반 인증 방식** <br>
> Bearer과 Access 토큰을 Authorization 헤더에 입력하는 인증 방식이다.
