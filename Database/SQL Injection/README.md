## SQL Injection

<img src="https://github.com/user-attachments/assets/ff3edc23-12c8-4ea1-bf35-496a50f5cdcb"/>

해커에 의해 조작된 SQL 쿼리문이 데이터베이스에 그대로 전달되어 비정상적 명령을 실행시키는 공격 기법이다. 공격이 비교적 쉬운 편이고 공격에 성공할 경우 큰 피해를 입힐 수 있다. <br><br>

### 공격 방법

---

1. **인증 우회** <br>
   아이디가 'abc', 비밀번호가 '1234'일 때 쿼리는 아래와 같은 방법으로 전송된다 <br>
   `SELECT * FROM USER WHERE ID = "abc" AND PASSWORD = "1234"`
   <br><br>
   SQL Injection으로 공격할 때 input 창에 비밀번호를 입력함과 동시에 다른 쿼리문을 함께 입력하는 것이다 <br>
   `1234; DELETE * USER FROM ID = "1"`
   <br><br>
   보안이 완벽하지 않은 경우 이처럼 비밀번호가 아이디와 일치해서 True가 되고 **뒤에 작성한 DELETE문도 데이터베이스에 영향**을 줄 수 있다
   <br><br>

2. **데이터 노출** <br>
   시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법 <br>
   해커들은 에러를 역이용해 악의적인 구문을 삽입하여 에러를 유발시킨다 <br><br>
   예를 들어 해커는 GET 방식으로 동작하는 URL 쿼리 스트링을 추가하여 에러를 발생시킨다. 이에 해당하는 오류가 발생하면 이를 통해 해당 웹앱의 데이터베이스 구조를 유추할 수 있다.

<br>

### 방어 방법

---

1. **input 값을 받을 때 특수문자 여부 검사하기** <br>
   로그인 전, 검증 로직을 추가하여 미리 설정한 특수문자들이 들어왔을 때 요청을 막아낸다
   <br><br>
2. **SQL 서버 오류 발생 시, 해당하는 에러 메시지 감추기** <br>
   view를 활용하여 원본 데이터베이스 테이블에는 접근 권한을 높인다. 일반 사용자는 view로만 접근하여 에러를 볼 수 없도록 만든다
   <br><br>
3. **preparestatement 사용하기** <br>
   preparestatement를 사용하면 특수문자를 자동으로 escaping 해준다. (쿼리문에서 전달인자 값을 ?로 받는 것) 이를 활용하여 서버 측에서 필터링 과정을 통해 공격을 방어한다
   <br><br>
4. **웹 방화벽 활용** <br>
   서버에 웹 방화벽 제품을 설치하여 공격을 탐지하고 차단한다. 패턴을 기반으로 분석하여 SQL 인젝션으로 보이는 요청을 감지하고 차단한다.

<br><br>

### 면접 질문 예상

---

<details>
   <summary>SQL 인젝션 공격은 무엇이며 어떻게 방어할 수 있나요?</summary>
   공격자가 악의적인 SQL 코드를 입력하여 데이터베이스에 대한 비정상적인 접근이나 조작을 시도하는 공격입니다. 주로 웹 애플리케이션에서 사용자 입력을 통해 SQL 쿼리를 작성할 때 입력값이 제대로 검증되지 않거나 필터링되지 않아 발생합니다.
   <br><br>
   방어 방법으로는 Prepared Statements를 사용할 수 있습니다. Prepared Statements는 SQL 쿼리를 미리 정의하고 사용자 입력을 바인딩하여 실행하는 방법으로, 입력값이 SQL 코드로 해석되지 않도록 방지할 수 있습니다.
   <br><br>
   또한 입력값을 검증하거나 웹 애플리케이션 방화벽을 사용하여 SQL 인젝션 패턴을 탐지하고 차단할 수 있습니다.
</details>

<br><br>
**[참고]** <br>
https://m.boannews.com/html/detail.html?mtype=3&tab_type=H&idx=128286
