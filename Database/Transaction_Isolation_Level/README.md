# 트랜잭션 격리 수준 (Transaction Isolation Level)

트랜잭션 격리 수준은 데이터베이스에서 트랜잭션이 동시에 실행될 때, 다른 트랜잭션에 의한 간섭을 얼마나 허용할 것인지를 정의합니다. 격리 수준은 트랜잭션이 일관성 있는 데이터를 읽을 수 있도록 보장하며, 동시에 동시성 성능을 조절하는 중요한 역할을 한다.

## Isolation Level의 필요성

- 데이터베이스는 ACID 특성을 기반으로 트랜잭션이 독립적으로 수행되도록 한다.
- Locking을 통해 트랜잭션이 DB를 다루는 동안 다른 트랜잭션의 간섭을 방지할 필요가 있다.
- 그러나 Locking을 지나치게 강화하면 데이터베이스 성능이 떨어질 수 있다. 반면, Locking 범위를 줄이면 잘못된 데이터 처리 문제가 발생할 수 있다.
- 따라서 효율적인 Locking 전략이 필요하다.

## Isolation Level 종류

### Read Uncommitted (레벨 0)
- **특징**: SELECT 문장이 수행되는 동안 해당 데이터에 Shared Lock이 걸리지 않음.
- **허용**: 트랜잭션이 처리 중이거나 아직 Commit되지 않은 데이터를 다른 트랜잭션이 읽을 수 있음.
- **문제점**: 데이터베이스의 일관성을 유지할 수 없음.
- **발생 현상**: Dirty Read.

### Read Committed (레벨 1)
- **특징**: SELECT 문장이 수행되는 동안 해당 데이터에 Shared Lock이 걸림.
- **허용**: Commit이 이루어진 트랜잭션만 조회 가능.
- **문제점**: 트랜잭션이 수행되는 동안 다른 트랜잭션이 접근할 수 없어 대기하게 됨.
- **발생 현상**: Non-Repeatable Read.

### Repeatable Read (레벨 2)
- **특징**: 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸림.
- **허용**: 트랜잭션이 범위 내에서 조회한 데이터 내용이 항상 동일함을 보장.
- **문제점**: 다른 사용자는 트랜잭션 영역에 해당되는 데이터에 대한 수정을 할 수 없음.
- **발생 현상**: Phantom Read.
- **기본값**: MySQL에서 Default로 사용하는 Isolation Level.

### Serializable (레벨 3)
- **특징**: 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸림.
- **허용**: 완벽한 읽기 일관성 모드를 제공하며, 다른 사용자는 트랜잭션 영역에 해당되는 데이터에 대한 수정 및 입력이 불가능.
- **문제점**: 데이터베이스 성능이 저하될 수 있음.
- **발생 현상**: 발생하는 현상이 적음.

## 선택 시 고려사항

- **동시성과 데이터 무결성**: 격리 수준을 높이면 데이터 무결성은 유지되지만 동시성이 떨어질 수 있습니다. 반대로 동시성을 증가시키면 데이터 무결성에 문제가 발생할 수 있다.
- **비용**: 격리 수준을 높일수록 발생하는 비용이 증가한다.

## 낮은 단계 Isolation Level에서 발생하는 현상

### Dirty Read
- **설명**: 커밋되지 않은 수정 중인 데이터를 다른 트랜잭션에서 읽을 수 있는 현상.
- **예시**: 트랜잭션 A가 데이터를 수정 중일 때, 트랜잭션 B가 수정 중인 데이터를 읽는 경우.
- **발생 Level**: Read Uncommitted.

### Non-Repeatable Read
- **설명**: 한 트랜잭션에서 같은 쿼리를 두 번 수행할 때, 그 사이에 다른 트랜잭션이 값을 수정하거나 삭제하여 두 쿼리의 결과가 상이하게 나타나는 현상.
- **예시**: 트랜잭션 A가 같은 데이터에 대해 두 번 조회할 때, 트랜잭션 B가 그 사이에 데이터를 수정한 경우.
- **발생 Level**: Read Committed, Read Uncommitted.

### Phantom Read
- **설명**: 한 트랜잭션 안에서 일정 범위의 레코드를 두 번 이상 읽었을 때, 첫 번째 쿼리에서 없던 레코드가 두 번째 쿼리에서 나타나는 현상.
- **예시**: 트랜잭션 A가 특정 범위의 데이터를 조회하는 동안, 트랜잭션 B가 그 범위에 새로운 레코드를 삽입하는 경우.
- **발생 Level**: Repeatable Read, Read Committed, Read Uncommitted.

## 면접 예상 질문

### 1. 트랜잭션 격리 수준에 대해 설명하고, 각 수준이 데이터베이스의 성능과 일관성에 미치는 영향을 간단히 설명해보세요.

- **답변**:
  - **Read Uncommitted**: 데이터 일관성은 낮지만 성능이 높음. 커밋되지 않은 데이터도 읽을 수 있어 데이터 불일치가 발생할 수 있음.
  - **Read Committed**: 커밋된 데이터만 읽을 수 있어 일관성은 보장되지만, 데이터가 변경되면 두 번 읽을 때 결과가 달라질 수 있음.
  - **Repeatable Read**: 같은 트랜잭션 내에서 읽은 데이터는 일관되게 유지되지만, 데이터가 추가되면 읽을 때 새로운 데이터가 나타날 수 있음.
  - **Serializable**: 가장 높은 일관성을 보장하며, 모든 트랜잭션이 순차적으로 처리됨. 성능은 가장 낮을 수 있음.

### 2. `Dirty Read`, `Non-Repeatable Read`, `Phantom Read`란 무엇인지 설명하고, 어떤 격리 수준에서 발생하는지 알려주세요.
- **답변**:
  - **Dirty Read**: 다른 트랜잭션이 커밋되지 않은 데이터를 읽는 현상. `Read Uncommitted`에서 발생.
  - **Non-Repeatable Read**: 같은 트랜잭션 내에서 같은 데이터를 두 번 읽을 때 결과가 다를 수 있는 현상. `Read Committed`에서 발생할 수 있음.
  - **Phantom Read**: 트랜잭션이 특정 범위의 데이터를 두 번 읽을 때, 중간에 새로운 데이터가 추가되어 결과가 달라지는 현상. `Repeatable Read`에서 발생할 수 있음.


